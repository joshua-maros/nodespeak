image: rust:1.37

stages:
  - init_build
  - test
  - document
  - final_build
  - publish

build:
  stage: init_build
  script: cargo build
  only: 
    - master
    - merge_requests
  artifacts:
    paths:
    - target
    expire_in: 30 minutes

test:
  stage: test
  dependencies: 
    - build
  script: cargo test
  only: 
    - master
    - merge_requests

doc:
  stage: document
  image: rustlang/rust:nightly
  script: cargo doc
  only: 
    - master
  artifacts:
    paths:
    - target/doc
  
final_build:
  stage: final_build
  script: cargo build --release
  only: 
    - master
  artifacts:
    paths: 
    - target/release/compile
    expire_in: 30 minutes

pub_bin:
  stage: publish
  dependencies: 
    - final_build
  script: cp -r target/release/compile compile
  only: 
    - master
  artifacts:
    paths:
    - compile

pub_doc:
  stage: publish
  dependencies: 
    - doc
  script: mv target/doc public/
  only: 
    - master
  artifacts:
    paths:
    - public
